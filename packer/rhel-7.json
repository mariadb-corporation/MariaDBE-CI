{
  "variables": {
    "RHEL_PASSWD": ""
  },
  "builders": [
    {
      "type": "googlecompute",
      "project_id": "mariadb-enterprise-server",
      "source_image_project_id": "rhel-cloud",
      "source_image": "rhel-7-v20200309",
      "zone": "us-central1-a",
      "communicator": "ssh",
      "disk_size": "60",
      "image_name": "jw-rhel-7-{{timestamp}}",
      "image_family": "jw-rhel-7",
      "ssh_username": "rhel"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": ["sudo yum -y install subscription-manager",
        "sudo subscription-manager register --auto-attach --force --username dbart@mariadb.com --password {{user `RHEL_PASSWD`}}",
          "sudo subscription-manager repos --enable=rhel-7-server-optional-rpms", "sudo subscription-manager release --set=7.5",
          "sudo yum -y install wget tar gzip bzip2", "sudo yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm || true",
          "sudo yum -y upgrade", "sudo yum -y groupinstall 'Development Tools'", "sudo yum -y install unixODBC-devel unixODBC",
          "sudo yum -y install git python-devel libffi-devel openssl-devel",
          "sudo yum -y install python-pip redhat-rpm-config curl bison libaio lsof perl-DBI boost-program-options ncurses-devel wget perl-XML-Simple",
          "sudo yum -y install perl-Time-HiRes perl-Test-HTTP-Server-Simple libcurl-devel mhash-devel sudo libxml2-devel libaio-devel scons",
          "sudo yum -y install boost-devel check-devel which Judy-devel cracklib-devel pam-devel rsync socat lsof valgrind redhat-lsb-core expect",
          "sudo yum -y install clang perl-CPAN jemalloc net-tools snappy-devel perl-DBI perl-DBD-MySQL readline-devel systemd-devel",
          "sudo rm /etc/security/limits.d/90-nproc.conf || true", "sudo yum -y erase cmake || true",
          "wget https://cmake.org/files/v3.15/cmake-3.15.3-Linux-x86_64.sh -O /tmp/cmake-3.15.3-Linux-x86_64.sh",
          "sudo /bin/bash /tmp/cmake-3.15.3-Linux-x86_64.sh --prefix=/usr --exclude-subdir --skip-license",
          "rm -f /tmp/cmake-3.15.3-Linux-x86_64.sh", "sudo yum -y install java-1.8.0-openjdk-headless"]
    }
  ]
}
